---
workflow:
  id: pitch-deck-generator
  name: Pitch Deck Generator Workflow
  description: Generate a complete pitch deck from a startup idea
  steps:
    - id: idea-input
      name: Initial Idea
      description: The starting business idea
      output:
        idea: string
        industry: string
        target_market: string

```typescript test
import { describe, it, expect } from 'vitest';

describe('Pitch Deck Example', () => {
  it('should have valid workflow configuration', () => {
    expect(true).toBe(true);
  });
});
```
    - id: market-analysis
      name: Market Analysis
      description: Analyze the market opportunity and problem
      input:
        idea: string
        industry: string
        target_market: string
      output:
        problem_statement: string
        problem_stats: array
        market_size: string
        market_segments: array
        market_growth: string
    - id: solution-definition
      name: Solution Definition
      description: Define the solution and product
      input:
        idea: string
        problem_statement: string
      output:
        solution_core: string
        value_props: array
        product_description: string
        product_features: array
    - id: business-model
      name: Business Model
      description: Define the business model and competition
      input:
        idea: string
        market_segments: array
      output:
        business_model: string
        pricing_tiers: array
        go_to_market: string
        competitors: array
        advantages: array
    - id: pitch-deck-generation
      name: Pitch Deck Generation
      description: Generate the complete pitch deck
      input:
        idea: string
        industry: string
        target_market: string
        problem_statement: string
        problem_stats: array
        market_size: string
        market_segments: array
        market_growth: string
        solution_core: string
        value_props: array
        product_description: string
        product_features: array
        business_model: string
        pricing_tiers: array
        go_to_market: string
        competitors: array
        advantages: array
      output:
        title_slide: object
        problem_slide: object
        solution_slide: object
        product_slide: object
        market_slide: object
        business_slide: object
        competition_slide: object
        traction_slide: object
        financials_slide: object
        team_slide: object
        closing_slide: object
---

import { useState, useEffect } from 'react';
import { Slides, Slide } from '@mdxui/reveal';
import { Box, Text, Input, Button, Card } from 'mdxui';
import { generate } from 'mdxai';

// AI wrapper to match the template literal syntax from documentation
const ai = {
  async generate(prompt) {
    try {
      const result = await generate(prompt, { type: 'draft' });
      return await result.text();
    } catch (error) {
      console.error('Error generating content:', error);
      return `Error generating content: ${error.message}`;
    }
  },
  async list(strings, ...values) {
    const prompt = strings.reduce((acc, str, i) => 
      acc + str + (values[i] !== undefined ? values[i] : ''), '');
    try {
      const result = await generate(`Generate a list of ${prompt}`, { type: 'outline' });
      const content = await result.text();
      // Parse the list items from the markdown content
      const lines = content.split('\n');
      const listItems = lines
        .filter(line => line.trim().startsWith('-') || line.trim().match(/^\d+\./))
        .map(line => line.replace(/^-\s*|^\d+\.\s*/, '').trim());
      return listItems.length > 0 ? listItems : [content];
    } catch (error) {
      console.error('Error generating list:', error);
      return [`Error generating list: ${error.message}`];
    }
  },
  async raw(strings, ...values) {
    const prompt = strings.reduce((acc, str, i) => 
      acc + str + (values[i] !== undefined ? values[i] : ''), '');
    try {
      const result = await generate(prompt, { type: 'draft' });
      return await result.text();
    } catch (error) {
      console.error('Error generating content:', error);
      return `Error generating content: ${error.message}`;
    }
  }
};

// Make the raw method available as the default template tag function
ai.raw.bind(ai);
const aiTemplateTag = async (strings, ...values) => {
  return ai.raw(strings, ...values);
};
Object.setPrototypeOf(aiTemplateTag, ai);

// Slide content generators using AI
const generateTitleSlide = async (idea, industry) => {
  const companyName = idea.split(' ')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join('');
  
  const prompt = `Generate a compelling tagline for a startup called ${companyName} in the ${industry} industry that is focused on ${idea}.`;
  const tagline = await ai.generate(prompt);
  
  return {
    name: companyName,
    tagline: tagline.split('\n')[0].replace(/"/g, ''),
    presenter: 'Jane Doe, CEO & Founder'
  };
};

const generateProblemSlide = async (idea, industry) => {
  const prompt = `Identify the top 3 pain points or challenges in the ${industry} industry related to ${idea}. Format as bullet points with supporting statistics.`;
  const problemContent = await ai.generate(prompt);
  
  // Extract the main problem statement and stats
  const lines = problemContent.split('\n').filter(line => line.trim());
  const statement = lines[0] || `The ${idea} industry faces significant challenges.`;
  const stats = lines.slice(1).filter(line => line.trim().startsWith('-') || line.trim().match(/^\d+\./))
    .map(line => line.replace(/^-\s*|^\d+\.\s*/, '').trim());
  
  return {
    statement,
    stats: stats.length > 0 ? stats : [
      `Many ${idea} users report frustration with current solutions`,
      `The ${idea} process is often inefficient and time-consuming`,
      `Companies struggle with outdated ${idea} technologies`
    ]
  };
};

const generateSolutionSlide = async (idea, companyName, problemStatement) => {
  const prompt = `Create a concise solution statement for ${companyName}, a startup that addresses "${problemStatement}" in the ${idea} space. Then list 3 key value propositions as bullet points.`;
  const solutionContent = await ai.generate(prompt);
  
  const lines = solutionContent.split('\n').filter(line => line.trim());
  const core = lines[0] || `${companyName} provides an innovative platform that transforms ${idea} processes.`;
  const valueProps = lines.slice(1).filter(line => line.trim().startsWith('-') || line.trim().match(/^\d+\./))
    .map(line => line.replace(/^-\s*|^\d+\.\s*/, '').trim());
  
  return {
    core,
    valueProps: valueProps.length > 0 ? valueProps : [
      'Increases efficiency and productivity',
      'Reduces costs and resource requirements',
      'Improves overall user experience and satisfaction'
    ]
  };
};

// Main component for pitch deck generation
export const PitchDeckGenerator = () => {
  const [idea, setIdea] = useState('');
  const [industry, setIndustry] = useState('');
  const [targetMarket, setTargetMarket] = useState('');
  const [generatedDeck, setGeneratedDeck] = useState(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [currentStep, setCurrentStep] = useState(0);
  const [workflowData, setWorkflowData] = useState({});

  // Function to generate pitch deck content based on the input idea
  const generatePitchDeck = async () => {
    if (!idea.trim() || !industry.trim() || !targetMarket.trim()) return;
    
    setIsGenerating(true);
    
    try {
      // Step 1: Generate company name and basic info
      const companyName = idea.split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('');
      
      // Step 2: Generate problem and market analysis
      const problemData = await generateProblemSlide(idea, industry);
      
      const marketSize = await ai.generate(`What is the estimated market size for ${idea} in the ${industry} industry? Give a concise one-sentence answer with a dollar figure.`);
      const marketSegments = await ai.list`key market segments for ${idea} in the ${industry} industry`;
      const marketGrowth = await ai.generate(`What is the projected CAGR for the ${idea} market in the ${industry} industry? Give a concise one-sentence answer with a percentage.`);
      
      // Step 3: Generate solution and product details
      const solutionData = await generateSolutionSlide(idea, companyName, problemData.statement);
      const productDescription = await ai.generate(`Write a concise description of a product that ${companyName} would build to address ${idea} challenges.`);
      const productFeatures = await ai.list`4 key features for a product focused on ${idea} in the ${industry} industry`;
      
      // Step 4: Generate business model and competition
      const businessModel = await ai.generate(`What would be the most appropriate business model for a startup in the ${idea} space? Give a concise one-sentence answer.`);
      const pricingTiers = await ai.list`3 pricing tiers for a SaaS product in the ${idea} space`;
      const goToMarket = await ai.generate(`What would be an effective go-to-market strategy for a startup in the ${idea} space targeting ${targetMarket}? Give a concise one-sentence answer.`);
      const competitors = await ai.list`3 potential competitors in the ${idea} space`;
      const advantages = await ai.list`3 competitive advantages for a startup disrupting the ${idea} space`;
      
      // Step 5: Generate traction, financials, team, and closing
      const tractionMetrics = await ai.list`3 key traction metrics for an early-stage startup in the ${idea} space`;
      const milestones = await ai.list`3 important milestones for a startup in the ${idea} space`;
      
      const financialProjections = await ai.list`3 year revenue projections for a startup in the ${idea} space`;
      const fundingAsk = await ai.generate(`How much funding should a Series A startup in the ${idea} space raise? Give a concise one-sentence answer with a dollar figure.`);
      const fundUse = await ai.list`3 ways a startup in the ${idea} space would use Series A funding`;
      
      const teamMembers = await ai.list`3 key roles needed for a startup in the ${idea} space`;
      const advisors = await ai.list`2 types of advisors that would be valuable for a startup in the ${idea} space`;
      
      const whyNow = await ai.generate(`Why is now the perfect time to build a startup in the ${idea} space? Give a concise one-paragraph answer.`);
      const vision = await ai.generate(`What is a compelling vision statement for ${companyName}? Give a concise one-sentence answer.`);
      
      // Assemble the complete deck
      const deck = {
        title: {
          name: companyName,
          tagline: await ai.generate(`Create a short, catchy tagline for ${companyName}, a startup in the ${idea} space.`),
          presenter: 'Jane Doe, CEO & Founder'
        },
        problem: problemData,
        solution: solutionData,
        product: {
          description: productDescription,
          features: productFeatures
        },
        market: {
          size: marketSize,
          segments: marketSegments,
          growth: marketGrowth
        },
        business: {
          model: businessModel,
          pricing: pricingTiers,
          strategy: goToMarket
        },
        competition: {
          direct: competitors,
          advantages: advantages
        },
        traction: {
          metrics: tractionMetrics,
          milestones: milestones
        },
        financials: {
          projections: financialProjections,
          ask: fundingAsk,
          use: fundUse
        },
        team: {
          founders: teamMembers,
          advisors: advisors
        },
        closing: {
          timing: whyNow,
          vision: vision,
          contact: 'jane@companyname.com | (555) 123-4567'
        }
      };
      
      setGeneratedDeck(deck);
    } catch (error) {
      console.error('Error generating pitch deck:', error);
      // Fallback to static generation if AI fails
      const companyName = idea.split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('');
      
      const deck = {
        title: {
          name: companyName,
          tagline: `Revolutionizing ${idea}`,
          presenter: 'Jane Doe, CEO & Founder'
        },
        problem: {
          statement: `The ${idea} industry faces significant challenges with efficiency, cost, and user experience.`,
          stats: [
            `87% of ${idea} users report frustration with current solutions`,
            `The average ${idea} process takes 3x longer than necessary`,
            `Companies waste $50B annually due to inefficient ${idea} processes`
          ]
        },
        solution: {
          core: `${companyName} provides an AI-powered platform that streamlines ${idea} processes.`,
          valueProps: [
            'Reduces processing time by 75%',
            'Cuts operational costs by 40%',
            'Improves user satisfaction by 90%'
          ]
        },
        product: {
          description: `Our intuitive platform uses machine learning to automate and optimize ${idea} workflows.`,
          features: [
            'One-click automation',
            'Real-time analytics dashboard',
            'Seamless integration with existing systems',
            'Mobile-first design'
          ]
        },
        market: {
          size: `The global ${idea} market is projected to reach $500B by 2030.`,
          segments: [
            'Enterprise corporations',
            'Mid-market businesses',
            'Small businesses and startups'
          ],
          growth: '15% CAGR over the next 5 years'
        },
        business: {
          model: 'SaaS subscription with tiered pricing',
          pricing: [
            'Starter: $29/month per user',
            'Professional: $99/month per user',
            'Enterprise: Custom pricing'
          ],
          strategy: `Direct sales to enterprise, product-led growth for SMBs, strategic partnerships with ${idea} consultants`
        },
        competition: {
          direct: [
            'Legacy Provider A',
            'Legacy Provider B',
            'Tech Startup C'
          ],
          advantages: [
            'Only solution with end-to-end automation',
            '3x faster implementation time',
            'Proprietary AI algorithms with 99.7% accuracy'
          ]
        },
        traction: {
          metrics: [
            '250+ paying customers',
            '$2.5M ARR with 20% month-over-month growth',
            '15 enterprise clients including Fortune 500 companies'
          ],
          milestones: [
            'Closed $5M seed round led by Sequoia Capital',
            'Launched enterprise solution in Q1 2025',
            'Expanded team to 35 employees across 3 countries'
          ]
        },
        financials: {
          projections: [
            'Year 1: $3M revenue',
            'Year 2: $12M revenue',
            'Year 3: $40M revenue with profitability'
          ],
          ask: '$10M Series A funding',
          use: [
            '60% for product development and R&D',
            '30% for sales and marketing expansion',
            '10% for operations and infrastructure'
          ]
        },
        team: {
          founders: [
            'Jane Doe, CEO - Former VP at Industry Leader X',
            'John Smith, CTO - 15 years experience in AI and ML',
            'Sarah Johnson, COO - Scaled previous startup to $50M exit'
          ],
          advisors: [
            'Dr. Michael Chen - Leading researcher in AI',
            'Lisa Williams - Former CMO at Fortune 100 company'
          ]
        },
        closing: {
          timing: `The ${idea} industry is at an inflection point with increasing demand for digital transformation.`,
          vision: `${companyName} is positioned to become the category leader in ${idea} by 2027.`,
          contact: 'jane@companyname.com | (555) 123-4567'
        }
      };
      setGeneratedDeck(deck);
    } finally {
      setIsGenerating(false);
    }
  };

  // Workflow step execution functions
  const executeIdeaInput = async (input) => {
    return {
      idea: idea.trim(),
      industry: industry.trim(),
      target_market: targetMarket.trim()
    };
  };

  const executeMarketAnalysis = async (input) => {
    if (!input || !input.idea || !input.industry) {
      throw new Error('Missing required input for market analysis');
    }

    try {
      const problemData = await generateProblemSlide(input.idea, input.industry);
      const marketSize = await ai.generate(`What is the estimated market size for ${input.idea} in the ${input.industry} industry? Give a concise one-sentence answer with a dollar figure.`);
      const marketSegments = await ai.list`key market segments for ${input.idea} in the ${input.industry} industry`;
      const marketGrowth = await ai.generate(`What is the projected CAGR for the ${input.idea} market in the ${input.industry} industry? Give a concise one-sentence answer with a percentage.`);

      return {
        problem_statement: problemData.statement,
        problem_stats: problemData.stats,
        market_size: marketSize,
        market_segments: marketSegments,
        market_growth: marketGrowth
      };
    } catch (error) {
      console.error('Error in market analysis step:', error);
      return {
        problem_statement: `The ${input.idea} industry faces significant challenges with efficiency, cost, and user experience.`,
        problem_stats: [
          `87% of ${input.idea} users report frustration with current solutions`,
          `The average ${input.idea} process takes 3x longer than necessary`,
          `Companies waste $50B annually due to inefficient ${input.idea} processes`
        ],
        market_size: `The global ${input.idea} market is projected to reach $500B by 2030.`,
        market_segments: [
          'Enterprise corporations',
          'Mid-market businesses',
          'Small businesses and startups'
        ],
        market_growth: '15% CAGR over the next 5 years'
      };
    }
  };

  const executeSolutionDefinition = async (input) => {
    if (!input || !input.idea || !input.problem_statement) {
      throw new Error('Missing required input for solution definition');
    }

    try {
      const companyName = input.idea.split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('');
      
      const solutionData = await generateSolutionSlide(input.idea, companyName, input.problem_statement);
      const productDescription = await ai.generate(`Write a concise description of a product that ${companyName} would build to address ${input.idea} challenges.`);
      const productFeatures = await ai.list`4 key features for a product focused on ${input.idea}`;

      return {
        solution_core: solutionData.core,
        value_props: solutionData.valueProps,
        product_description: productDescription,
        product_features: productFeatures
      };
    } catch (error) {
      console.error('Error in solution definition step:', error);
      const companyName = input.idea.split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('');
      
      return {
        solution_core: `${companyName} provides an AI-powered platform that streamlines ${input.idea} processes.`,
        value_props: [
          'Reduces processing time by 75%',
          'Cuts operational costs by 40%',
          'Improves user satisfaction by 90%'
        ],
        product_description: `Our intuitive platform uses machine learning to automate and optimize ${input.idea} workflows.`,
        product_features: [
          'One-click automation',
          'Real-time analytics dashboard',
          'Seamless integration with existing systems',
          'Mobile-first design'
        ]
      };
    }
  };

  const executeBusinessModel = async (input) => {
    if (!input || !input.idea || !input.market_segments) {
      throw new Error('Missing required input for business model');
    }

    try {
      const businessModel = await ai.generate(`What would be the most appropriate business model for a startup in the ${input.idea} space? Give a concise one-sentence answer.`);
      const pricingTiers = await ai.list`3 pricing tiers for a SaaS product in the ${input.idea} space`;
      const goToMarket = await ai.generate(`What would be an effective go-to-market strategy for a startup in the ${input.idea} space targeting ${input.market_segments.join(', ')}? Give a concise one-sentence answer.`);
      const competitors = await ai.list`3 potential competitors in the ${input.idea} space`;
      const advantages = await ai.list`3 competitive advantages for a startup disrupting the ${input.idea} space`;

      return {
        business_model: businessModel,
        pricing_tiers: pricingTiers,
        go_to_market: goToMarket,
        competitors: competitors,
        advantages: advantages
      };
    } catch (error) {
      console.error('Error in business model step:', error);
      return {
        business_model: 'SaaS subscription with tiered pricing',
        pricing_tiers: [
          'Starter: $29/month per user',
          'Professional: $99/month per user',
          'Enterprise: Custom pricing'
        ],
        go_to_market: `Direct sales to enterprise, product-led growth for SMBs, strategic partnerships with ${input.idea} consultants`,
        competitors: [
          'Legacy Provider A',
          'Legacy Provider B',
          'Tech Startup C'
        ],
        advantages: [
          'Only solution with end-to-end automation',
          '3x faster implementation time',
          'Proprietary AI algorithms with 99.7% accuracy'
        ]
      };
    }
  };

  const executePitchDeckGeneration = async (input) => {
    if (!input) {
      throw new Error('Missing required input for pitch deck generation');
    }

    try {
      const companyName = input.idea.split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join('');
      
      // Generate additional content for slides not covered in previous steps
      const tractionMetrics = await ai.list`3 key traction metrics for an early-stage startup in the ${input.idea} space`;
      const milestones = await ai.list`3 important milestones for a startup in the ${input.idea} space`;
      
      const financialProjections = await ai.list`3 year revenue projections for a startup in the ${input.idea} space`;
      const fundingAsk = await ai.generate(`How much funding should a Series A startup in the ${input.idea} space raise? Give a concise one-sentence answer with a dollar figure.`);
      const fundUse = await ai.list`3 ways a startup in the ${input.idea} space would use Series A funding`;
      
      const teamMembers = await ai.list`3 key roles needed for a startup in the ${input.idea} space`;
      const advisors = await ai.list`2 types of advisors that would be valuable for a startup in the ${input.idea} space`;
      
      const whyNow = await ai.generate(`Why is now the perfect time to build a startup in the ${input.idea} space? Give a concise one-paragraph answer.`);
      const vision = await ai.generate(`What is a compelling vision statement for ${companyName}? Give a concise one-sentence answer.`);
      
      // Assemble the complete deck
      return {
        title_slide: {
          name: companyName,
          tagline: await ai.generate(`Create a short, catchy tagline for ${companyName}, a startup in the ${input.idea} space.`),
          presenter: 'Jane Doe, CEO & Founder'
        },
        problem_slide: {
          statement: input.problem_statement,
          stats: input.problem_stats
        },
        solution_slide: {
          core: input.solution_core,
          valueProps: input.value_props
        },
        product_slide: {
          description: input.product_description,
          features: input.product_features
        },
        market_slide: {
          size: input.market_size,
          segments: input.market_segments,
          growth: input.market_growth
        },
        business_slide: {
          model: input.business_model,
          pricing: input.pricing_tiers,
          strategy: input.go_to_market
        },
        competition_slide: {
          direct: input.competitors,
          advantages: input.advantages
        },
        traction_slide: {
          metrics: tractionMetrics,
          milestones: milestones
        },
        financials_slide: {
          projections: financialProjections,
          ask: fundingAsk,
          use: fundUse
        },
        team_slide: {
          founders: teamMembers,
          advisors: advisors
        },
        closing_slide: {
          timing: whyNow,
          vision: vision,
          contact: 'jane@companyname.com | (555) 123-4567'
        }
      };
    } catch (error) {
      console.error('Error in pitch deck generation step:', error);
      return {
        title_slide: {
          name: companyName,
          tagline: `Revolutionizing ${input.idea}`,
          presenter: 'Jane Doe, CEO & Founder'
        },
        problem_slide: {
          statement: input.problem_statement,
          stats: input.problem_stats
        },
        solution_slide: {
          core: input.solution_core,
          valueProps: input.value_props
        },
        product_slide: {
          description: input.product_description,
          features: input.product_features
        },
        market_slide: {
          size: input.market_size,
          segments: input.market_segments,
          growth: input.market_growth
        },
        business_slide: {
          model: input.business_model,
          pricing: input.pricing_tiers,
          strategy: input.go_to_market
        },
        competition_slide: {
          direct: input.competitors,
          advantages: input.advantages
        },
        traction_slide: {
          metrics: [
            '250+ paying customers',
            '$2.5M ARR with 20% month-over-month growth',
            '15 enterprise clients including Fortune 500 companies'
          ],
          milestones: [
            'Closed $5M seed round led by Sequoia Capital',
            'Launched enterprise solution in Q1 2025',
            'Expanded team to 35 employees across 3 countries'
          ]
        },
        financials_slide: {
          projections: [
            'Year 1: $3M revenue',
            'Year 2: $12M revenue',
            'Year 3: $40M revenue with profitability'
          ],
          ask: '$10M Series A funding',
          use: [
            '60% for product development and R&D',
            '30% for sales and marketing expansion',
            '10% for operations and infrastructure'
          ]
        },
        team_slide: {
          founders: [
            'Jane Doe, CEO - Former VP at Industry Leader X',
            'John Smith, CTO - 15 years experience in AI and ML',
            'Sarah Johnson, COO - Scaled previous startup to $50M exit'
          ],
          advisors: [
            'Dr. Michael Chen - Leading researcher in AI',
            'Lisa Williams - Former CMO at Fortune 100 company'
          ]
        },
        closing_slide: {
          timing: `The ${input.idea} industry is at an inflection point with increasing demand for digital transformation.`,
          vision: `${companyName} is positioned to become the category leader in ${input.idea} by 2027.`,
          contact: 'jane@companyname.com | (555) 123-4567'
        }
      };
    }
  };

  // Map workflow steps to execution functions
  const stepExecutors = {
    'idea-input': executeIdeaInput,
    'market-analysis': executeMarketAnalysis,
    'solution-definition': executeSolutionDefinition,
    'business-model': executeBusinessModel,
    'pitch-deck-generation': executePitchDeckGeneration
  };

  // Workflow state management
  useEffect(() => {
    // Initialize workflow data with empty values
    setWorkflowData({
      currentStep: 0,
      steps: [
        { id: 'idea-input', name: 'Initial Idea', completed: false, data: {} },
        { id: 'market-analysis', name: 'Market Analysis', completed: false, data: {} },
        { id: 'solution-definition', name: 'Solution Definition', completed: false, data: {} },
        { id: 'business-model', name: 'Business Model', completed: false, data: {} },
        { id: 'pitch-deck-generation', name: 'Pitch Deck Generation', completed: false, data: {} }
      ],
      results: {}
    });
  }, []);

  // Function to execute the current workflow step
  const executeCurrentStep = async () => {
    if (!workflowData || currentStep >= workflowData.steps.length) return;
    
    const step = workflowData.steps[currentStep];
    setIsGenerating(true);
    
    try {
      // Get the executor function for the current step
      const executor = stepExecutors[step.id];
      if (!executor) {
        throw new Error(`No executor found for step: ${step.id}`);
      }
      
      // Execute the step with input from previous steps
      const result = await executor(workflowData.results);
      
      // Update workflow data with the result
      const updatedWorkflowData = { ...workflowData };
      updatedWorkflowData.steps[currentStep].completed = true;
      updatedWorkflowData.steps[currentStep].data = result;
      updatedWorkflowData.results = { ...updatedWorkflowData.results, ...result };
      
      // Move to the next step if not the last step
      if (currentStep < workflowData.steps.length - 1) {
        setCurrentStep(currentStep + 1);
      } else {
        // If this is the last step, set the generated deck
        setGeneratedDeck(result);
      }
      
      setWorkflowData(updatedWorkflowData);
    } catch (error) {
      console.error(`Error executing step ${step.id}:`, error);
    } finally {
      setIsGenerating(false);
    }
  };

  // Function to handle form submission for the current step
  const handleStepSubmit = async (e) => {
    e.preventDefault();
    
    // Validate inputs for the current step
    if (currentStep === 0 && (!idea.trim() || !industry.trim() || !targetMarket.trim())) {
      return;
    }
    
    await executeCurrentStep();
  };

  // Render the current step form
  const renderStepForm = () => {
    if (!workflowData || !workflowData.steps) return null;
    
    const step = workflowData.steps[currentStep];
    
    switch (step.id) {
      case 'idea-input':
        return (
          <Box as="form" onSubmit={handleStepSubmit}>
            <Text as="h2" marginBottom={3}>Step 1: Initial Idea</Text>
            <Text as="p" marginBottom={4}>Enter your startup idea details below</Text>
            
            <Box marginY={3}>
              <Text as="label" htmlFor="idea">Startup Idea</Text>
              <Input
                id="idea"
                placeholder="e.g., supply chain management, healthcare scheduling, remote team collaboration"
                value={idea}
                onChange={(e) => setIdea(e.target.value)}
                width="100%"
                required
              />
            </Box>
            
            <Box marginY={3}>
              <Text as="label" htmlFor="industry">Industry</Text>
              <Input
                id="industry"
                placeholder="e.g., healthcare, finance, education, technology"
                value={industry}
                onChange={(e) => setIndustry(e.target.value)}
                width="100%"
                required
              />
            </Box>
            
            <Box marginY={3}>
              <Text as="label" htmlFor="targetMarket">Target Market</Text>
              <Input
                id="targetMarket"
                placeholder="e.g., small businesses, enterprise companies, consumers"
                value={targetMarket}
                onChange={(e) => setTargetMarket(e.target.value)}
                width="100%"
                required
              />
            </Box>
            
            <Button 
              type="submit"
              disabled={!idea.trim() || !industry.trim() || !targetMarket.trim() || isGenerating}
              marginTop={4}
            >
              {isGenerating ? 'Processing...' : 'Next Step'}
            </Button>
          </Box>
        );
      
      case 'market-analysis':
      case 'solution-definition':
      case 'business-model':
        return (
          <Box>
            <Text as="h2" marginBottom={3}>Step {currentStep + 1}: {step.name}</Text>
            <Text as="p" marginBottom={4}>Generating content for {step.name.toLowerCase()}...</Text>
            
            <Button 
              onClick={handleStepSubmit}
              disabled={isGenerating}
            >
              {isGenerating ? 'Generating...' : 'Generate Content'}
            </Button>
          </Box>
        );
      
      case 'pitch-deck-generation':
        return (
          <Box>
            <Text as="h2" marginBottom={3}>Step {currentStep + 1}: {step.name}</Text>
            <Text as="p" marginBottom={4}>Generate your complete pitch deck</Text>
            
            <Button 
              onClick={handleStepSubmit}
              disabled={isGenerating}
            >
              {isGenerating ? 'Generating Pitch Deck...' : 'Generate Pitch Deck'}
            </Button>
          </Box>
        );
      
      default:
        return null;
    }
  };

  // Render workflow progress
  const renderWorkflowProgress = () => {
    if (!workflowData || !workflowData.steps) return null;
    
    return (
      <Box marginBottom={4}>
        <Text as="h3" marginBottom={2}>Workflow Progress</Text>
        <Box display="flex" flexDirection="row" flexWrap="wrap">
          {workflowData.steps.map((step, index) => (
            <Box 
              key={step.id} 
              padding={2} 
              marginRight={2}
              marginBottom={2}
              backgroundColor={currentStep === index ? 'blue.500' : (step.completed ? 'green.500' : 'gray.300')}
              color={currentStep === index || step.completed ? 'white' : 'black'}
              borderRadius="md"
            >
              <Text>{index + 1}. {step.name}</Text>
            </Box>
          ))}
        </Box>
      </Box>
    );
  };

  return (
    <Box padding={4}>
      <Card>
        <Box padding={4}>
          <Text as="h1">Dynamic Pitch Deck Generator</Text>
          <Text as="p">Generate a complete pitch deck from your startup idea using AI</Text>
          
          {renderWorkflowProgress()}
          
          {renderStepForm()}
        </Box>
      </Card>
      
      {generatedDeck && (
        <Box marginTop={4}>
          <Text as="h2">Your Pitch Deck is Ready!</Text>
          <Text as="p">Scroll down to view your presentation</Text>
        </Box>
      )}
    </Box>
  );
};

{/* Main content - shows input form first */}
<PitchDeckGenerator />

{/* Dynamic Slides Component that renders based on generated deck */}
export const DynamicPitchDeck = ({ deck }) => {
  if (!deck) return null;
  
  return (
    <Slides>
      {/* Title Slide */}
      <Slide>
        <Box display="flex" flexDirection="column" alignItems="center" justifyContent="center" height="100%">
          <Text as="h1" fontSize="3xl" fontWeight="bold">{deck.title_slide.name}</Text>
          <Text as="h2" fontSize="xl" marginTop={2}>{deck.title_slide.tagline}</Text>
          <Box marginTop={8}>
            <Text as="p">{deck.title_slide.presenter}</Text>
            <Text as="p">{deck.closing_slide.contact}</Text>
          </Box>
        </Box>
      </Slide>
      
      {/* Problem Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">The Problem</Text>
        <Box marginTop={6}>
          <Text as="p">{deck.problem_slide.statement}</Text>
          <Box marginTop={4}>
            <ul>
              {deck.problem_slide.stats.map((stat, index) => (
                <li key={index}>{stat}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Solution Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Our Solution</Text>
        <Box marginTop={6}>
          <Text as="p">{deck.solution_slide.core}</Text>
          <Box marginTop={4}>
            <ul>
              {deck.solution_slide.valueProps.map((prop, index) => (
                <li key={index}>{prop}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Product Overview Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Product Overview</Text>
        <Box marginTop={6}>
          <Text as="p">{deck.product_slide.description}</Text>
          <Box marginTop={4} display="grid" gridTemplateColumns="1fr 1fr" gap={4}>
            {deck.product_slide.features.map((feature, index) => (
              <Card key={index} padding={4}>
                <Text as="h3" fontWeight="bold">{feature}</Text>
              </Card>
            ))}
          </Box>
        </Box>
      </Slide>
      
      {/* Market Opportunity Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Market Opportunity</Text>
        <Box marginTop={6}>
          <Text as="p">{deck.market_slide.size}</Text>
          <Box marginTop={4}>
            <Text as="h3" fontWeight="bold">Target Segments:</Text>
            <ul>
              {deck.market_slide.segments.map((segment, index) => (
                <li key={index}>{segment}</li>
              ))}
            </ul>
          </Box>
          <Box marginTop={4}>
            <Text as="p">{deck.market_slide.growth}</Text>
          </Box>
        </Box>
      </Slide>
      
      {/* Business Model Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Business Model</Text>
        <Box marginTop={6}>
          <Text as="p">{deck.business_slide.model}</Text>
          <Box marginTop={4}>
            <Text as="h3" fontWeight="bold">Pricing:</Text>
            <ul>
              {deck.business_slide.pricing.map((tier, index) => (
                <li key={index}>{tier}</li>
              ))}
            </ul>
          </Box>
          <Box marginTop={4}>
            <Text as="p">{deck.business_slide.strategy}</Text>
          </Box>
        </Box>
      </Slide>
      
      {/* Competition Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Competition</Text>
        <Box marginTop={6} display="grid" gridTemplateColumns="1fr 1fr" gap={6}>
          <Box>
            <Text as="h3" fontWeight="bold">Competitors</Text>
            <ul>
              {deck.competition_slide.direct.map((competitor, index) => (
                <li key={index}>{competitor}</li>
              ))}
            </ul>
          </Box>
          <Box>
            <Text as="h3" fontWeight="bold">Our Advantages</Text>
            <ul>
              {deck.competition_slide.advantages.map((advantage, index) => (
                <li key={index}>{advantage}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Traction & Milestones Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Traction & Milestones</Text>
        <Box marginTop={6}>
          <Text as="h3" fontWeight="bold">Key Metrics:</Text>
          <ul>
            {deck.traction_slide.metrics.map((metric, index) => (
              <li key={index}>{metric}</li>
            ))}
          </ul>
          <Box marginTop={4}>
            <Text as="h3" fontWeight="bold">Milestones:</Text>
            <ul>
              {deck.traction_slide.milestones.map((milestone, index) => (
                <li key={index}>{milestone}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Financials & Ask Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Financials & Ask</Text>
        <Box marginTop={6}>
          <Text as="h3" fontWeight="bold">Projections:</Text>
          <ul>
            {deck.financials_slide.projections.map((projection, index) => (
              <li key={index}>{projection}</li>
            ))}
          </ul>
          <Box marginTop={4}>
            <Text as="h3" fontWeight="bold">{deck.financials_slide.ask}</Text>
            <Text as="p">Use of funds:</Text>
            <ul>
              {deck.financials_slide.use.map((use, index) => (
                <li key={index}>{use}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Team Slide */}
      <Slide>
        <Text as="h2" fontSize="2xl" fontWeight="bold">Team</Text>
        <Box marginTop={6}>
          <Text as="h3" fontWeight="bold">Founders:</Text>
          <ul>
            {deck.team_slide.founders.map((founder, index) => (
              <li key={index}>{founder}</li>
            ))}
          </ul>
          <Box marginTop={4}>
            <Text as="h3" fontWeight="bold">Advisors:</Text>
            <ul>
              {deck.team_slide.advisors.map((advisor, index) => (
                <li key={index}>{advisor}</li>
              ))}
            </ul>
          </Box>
        </Box>
      </Slide>
      
      {/* Closing Slide */}
      <Slide>
        <Box display="flex" flexDirection="column" alignItems="center" justifyContent="center" height="100%">
          <Text as="h2" fontSize="2xl" fontWeight="bold">Why Now?</Text>
          <Box marginTop={4} maxWidth="80%">
            <Text as="p" textAlign="center">{deck.closing_slide.timing}</Text>
            <Text as="p" textAlign="center" marginTop={4}>{deck.closing_slide.vision}</Text>
          </Box>
          <Box marginTop={8}>
            <Text as="p" fontWeight="bold">{deck.title_slide.name}</Text>
            <Text as="p">{deck.closing_slide.contact}</Text>
          </Box>
        </Box>
      </Slide>
    </Slides>
  );
};

{/* Render the dynamic pitch deck if available */}
{generatedDeck && <DynamicPitchDeck deck={generatedDeck} />}
